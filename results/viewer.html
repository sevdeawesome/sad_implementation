<!DOCTYPE html>
<html>
<head>
    <title>Intervention Results Viewer</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .controls { display: flex; gap: 20px; margin-bottom: 20px; align-items: center; }
        select { padding: 8px; font-size: 14px; min-width: 200px; }
        .config { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; }
        .config pre { margin: 0; white-space: pre-wrap; }
        .pair { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; overflow: hidden; }
        .prompt { background: #e8f4ff; padding: 12px; font-weight: 500; }
        .response { padding: 12px; white-space: pre-wrap; }
        .strength-tag { background: #333; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px; }
        h3 { margin: 0 0 10px 0; }
        .load-section { margin-bottom: 20px; }
        #drop-zone { border: 2px dashed #ccc; padding: 40px; text-align: center; border-radius: 8px; margin-bottom: 10px; }
        #drop-zone.dragover { border-color: #333; background: #f9f9f9; }
    </style>
</head>
<body>
    <h1>Intervention Results Viewer</h1>

    <div class="load-section">
        <div id="drop-zone">Drop JSON files here or <input type="file" id="file-input" multiple accept=".json"></div>
    </div>

    <div class="controls">
        <label>File: <select id="file-select"><option value="">-- Load files above --</option></select></label>
        <label>Strength: <select id="strength-select"><option value="all">All</option></select></label>
    </div>

    <div id="config" class="config" style="display:none;"><h3>Config</h3><pre id="config-content"></pre></div>
    <div id="results"></div>

    <script>
        const files = {};
        let currentFile = null;

        const fileSelect = document.getElementById('file-select');
        const strengthSelect = document.getElementById('strength-select');
        const configDiv = document.getElementById('config');
        const configContent = document.getElementById('config-content');
        const resultsDiv = document.getElementById('results');
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');

        function loadFiles(fileList) {
            Array.from(fileList).forEach(file => {
                if (!file.name.endsWith('.json')) return;
                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        files[file.name] = JSON.parse(e.target.result);
                        updateFileSelect();
                    } catch (err) { alert(`Error parsing ${file.name}`); }
                };
                reader.readAsText(file);
            });
        }

        function updateFileSelect() {
            fileSelect.innerHTML = '<option value="">-- Select file --</option>';
            Object.keys(files).sort().forEach(name => {
                fileSelect.innerHTML += `<option value="${name}">${name}</option>`;
            });
        }

        function updateStrengthSelect() {
            if (!currentFile) return;
            const strengths = [...new Set(files[currentFile].results.map(r => r.strength))].sort((a,b) => a-b);
            strengthSelect.innerHTML = '<option value="all">All</option>';
            strengths.forEach(s => {
                strengthSelect.innerHTML += `<option value="${s}">${s}</option>`;
            });
        }

        function render() {
            if (!currentFile || !files[currentFile]) {
                configDiv.style.display = 'none';
                resultsDiv.innerHTML = '';
                return;
            }
            const data = files[currentFile];
            configDiv.style.display = 'block';
            configContent.textContent = JSON.stringify(data.config, null, 2);

            const strength = strengthSelect.value;
            const filtered = strength === 'all' ? data.results : data.results.filter(r => String(r.strength) === strength);

            resultsDiv.innerHTML = filtered.map(r => {
                if (!r.history || !r.history.length) return '';
                return r.history.map(h => `
                    <div class="pair">
                        <div class="prompt">${escapeHtml(h.prompt)}<span class="strength-tag">strength: ${r.strength}</span></div>
                        <div class="response">${escapeHtml(h.response)}</div>
                    </div>
                `).join('');
            }).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }

        fileSelect.onchange = () => { currentFile = fileSelect.value; updateStrengthSelect(); render(); };
        strengthSelect.onchange = render;
        fileInput.onchange = e => loadFiles(e.target.files);

        dropZone.ondragover = e => { e.preventDefault(); dropZone.classList.add('dragover'); };
        dropZone.ondragleave = () => dropZone.classList.remove('dragover');
        dropZone.ondrop = e => { e.preventDefault(); dropZone.classList.remove('dragover'); loadFiles(e.dataTransfer.files); };
    </script>
</body>
</html>
